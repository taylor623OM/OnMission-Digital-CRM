<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OnMission Digital CRM</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    
    <!-- Google API Client Library -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e9f2 100%);
        }
        .gradient-bg {
            background: linear-gradient(135deg, #DC7746 0%, #539CC3 100%);
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .status-badge {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            transition: all 0.2s ease;
        }
        .status-badge:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.12);
        }
        .timeline-item {
            position: relative;
            padding-left: 30px;
            padding-bottom: 20px;
        }
        .timeline-item::before {
            content: '';
            position: absolute;
            left: 8px;
            top: 8px;
            bottom: -12px;
            width: 2px;
            background: linear-gradient(180deg, #DC7746 0%, #539CC3 100%);
        }
        .timeline-dot {
            position: absolute;
            left: 0;
            top: 8px;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            border: 3px solid white;
            background: linear-gradient(135deg, #DC7746 0%, #539CC3 100%);
            box-shadow: 0 2px 8px rgba(220, 119, 70, 0.3);
        }
        .card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(0,0,0,0.05);
            background: white;
        }
        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0,0,0,0.12) !important;
            border-color: rgba(220, 119, 70, 0.2);
        }
        
        /* Dashboard Widget Enhancements */
        .dashboard-widget {
            background: white;
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            border: 1px solid rgba(0,0,0,0.05);
            position: relative;
            overflow: hidden;
        }
        .dashboard-widget::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #DC7746 0%, #539CC3 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .dashboard-widget:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
        }
        .dashboard-widget:hover::before {
            opacity: 1;
        }
        
        /* Icon Backgrounds with Gradients */
        .icon-gradient-orange {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
        }
        .icon-gradient-green {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
        }
        .icon-gradient-blue {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
        }
        .icon-gradient-purple {
            background: linear-gradient(135deg, #e9d5ff 0%, #d8b4fe 100%);
        }
        .icon-gradient-red {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
        }
        .icon-gradient-gray {
            background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
        }
        
        .sync-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 18px;
            background: white;
            border-radius: 24px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.12);
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 1000;
            border: 1px solid rgba(0,0,0,0.05);
        }
        .sync-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        .sync-dot.connected {
            background: #10b981;
            box-shadow: 0 0 12px rgba(16, 185, 129, 0.5);
        }
        .sync-dot.disconnected {
            background: #ef4444;
            box-shadow: 0 0 12px rgba(239, 68, 68, 0.5);
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(0.95); }
        }
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #DC7746 0%, #539CC3 100%);
        }
        .quick-add-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 64px;
            height: 64px;
            border-radius: 50%;
            background: linear-gradient(135deg, #DC7746 0%, #539CC3 100%);
            color: white;
            font-size: 24px;
            box-shadow: 0 8px 24px rgba(220, 119, 70, 0.4);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 999;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .quick-add-btn:hover {
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 12px 32px rgba(220, 119, 70, 0.5);
        }
        
        /* Button Enhancements */
        .btn-primary {
            background: linear-gradient(135deg, #DC7746 0%, #c96636 100%);
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            background: linear-gradient(135deg, #c96636 0%, #b85526 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(220, 119, 70, 0.3);
        }
        
        /* Smooth Scrolling */
        * {
            scroll-behavior: smooth;
        }
        
        /* Phase 3: Profile Pictures & Enhanced Cards */
        .profile-circle {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 18px;
            color: white;
            background: linear-gradient(135deg, #DC7746 0%, #539CC3 100%);
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            flex-shrink: 0;
        }
        
        .profile-circle-sm {
            width: 32px;
            height: 32px;
            font-size: 14px;
        }
        
        /* Status Indicator Dots */
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 0 0 1px rgba(0,0,0,0.1);
            flex-shrink: 0;
        }
        
        .status-dot-overdue {
            background: #ef4444;
            box-shadow: 0 0 12px rgba(239, 68, 68, 0.6);
            animation: pulse-red 2s infinite;
        }
        
        .status-dot-due-soon {
            background: #f59e0b;
            box-shadow: 0 0 12px rgba(245, 158, 11, 0.6);
        }
        
        .status-dot-active {
            background: #10b981;
        }
        
        @keyframes pulse-red {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.1); }
        }
        
        /* Enhanced Card Layout */
        .contact-card-header {
            display: flex;
            gap: 12px;
            align-items: start;
            margin-bottom: 16px;
        }
        
        .contact-card-info {
            flex: 1;
            min-width: 0;
        }
        
        .contact-card-meta {
            display: flex;
            gap: 8px;
            align-items: center;
            flex-wrap: wrap;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Initialize Firebase
        // Gmail API Configuration
        const GMAIL_CLIENT_ID = '1015420857416-npompsip7taabu15p04gt8537h02pso.apps.googleusercontent.com';
        const GMAIL_SCOPES = 'https://www.googleapis.com/auth/gmail.send https://www.googleapis.com/auth/gmail.readonly';

        const firebaseConfig = {
            apiKey: "AIzaSyB_9xIPVCKd-BZOtEMyPxhzHou1m97F55U",
            authDomain: "onmission-crm-376c4.firebaseapp.com",
            projectId: "onmission-crm-376c4",
            storageBucket: "onmission-crm-376c4.firebasestorage.app",
            messagingSenderId: "312236249225",
            appId: "1:312236249225:web:118ca7efee43b80de37658"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // Firebase helper functions
        const FirebaseService = {
            subscribeToContacts(callback) {
                return db.collection('contacts').onSnapshot(snapshot => {
                    const contacts = [];
                    snapshot.forEach(doc => {
                        contacts.push({ id: doc.id, ...doc.data() });
                    });
                    callback(contacts);
                });
            },

            async addContact(contact, userEmail) {
                try {
                    const docRef = await db.collection('contacts').add({
                        ...contact,
                        createdBy: userEmail,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    return docRef.id;
                } catch (error) {
                    console.error("Error adding contact:", error);
                    throw error;
                }
            },

            async updateContact(id, updates, userEmail) {
                try {
                    await db.collection('contacts').doc(id).update({
                        ...updates,
                        lastModifiedBy: userEmail,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                } catch (error) {
                    console.error("Error updating contact:", error);
                    throw error;
                }
            },

            async deleteContact(id) {
                try {
                    await db.collection('contacts').doc(id).delete();
                } catch (error) {
                    console.error("Error deleting contact:", error);
                    throw error;
                }
            },

            async addHistory(contactId, historyItem, userEmail) {
                try {
                    const contact = await db.collection('contacts').doc(contactId).get();
                    if (contact.exists) {
                        const currentHistory = contact.data().history || [];
                        await db.collection('contacts').doc(contactId).update({
                            history: [
                                { 
                                    ...historyItem, 
                                    id: Date.now(), 
                                    date: new Date().toISOString().split('T')[0],
                                    user: userEmail
                                },
                                ...currentHistory
                            ],
                            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    }
                } catch (error) {
                    console.error("Error adding history:", error);
                    throw error;
                }
            }
        };

        function LoginScreen({ onLoginSuccess }) {
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');
            const [loading, setLoading] = useState(false);

            const handleLogin = async (e) => {
                e.preventDefault();
                setError('');
                setLoading(true);

                try {
                    await auth.signInWithEmailAndPassword(email, password);
                    onLoginSuccess();
                } catch (error) {
                    console.error("Login error:", error);
                    setError(`Login failed: ${error.message}`);
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="login-container">
                    <div className="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md">
                        <div className="text-center mb-8">
                            <div className="inline-block p-4 bg-gradient-to-br from-orange-500 to-blue-500 rounded-full mb-4">
                                <i className="fas fa-church text-white text-4xl"></i>
                            </div>
                            <h1 className="text-3xl font-bold text-gray-900 mb-2">OnMission Digital</h1>
                            <p className="text-gray-600">Church Website Projects CRM</p>
                        </div>

                        <form onSubmit={handleLogin} className="space-y-6">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    Email Address
                                </label>
                                <input
                                    type="email"
                                    value={email}
                                    onChange={(e) => setEmail(e.target.value)}
                                    className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                                    placeholder="you@onmissiondigital.com"
                                    required
                                    autoComplete="email"
                                />
                            </div>

                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    Password
                                </label>
                                <input
                                    type="password"
                                    value={password}
                                    onChange={(e) => setPassword(e.target.value)}
                                    className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                                    placeholder="••••••••"
                                    required
                                    autoComplete="current-password"
                                />
                            </div>

                            {error && (
                                <div className="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm">
                                    <i className="fas fa-exclamation-circle mr-2"></i>
                                    {error}
                                </div>
                            )}

                            <button
                                type="submit"
                                disabled={loading}
                                className="w-full bg-gradient-to-r from-orange-500 to-blue-500 text-white py-3 rounded-lg font-semibold hover:from-orange-600 hover:to-blue-600 transition disabled:opacity-50 disabled:cursor-not-allowed"
                            >
                                {loading ? (
                                    <span className="flex items-center justify-center">
                                        <i className="fas fa-spinner fa-spin mr-2"></i>
                                        Signing in...
                                    </span>
                                ) : (
                                    'Sign In'
                                )}
                            </button>
                        </form>

                        <div className="mt-6 text-center text-sm text-gray-600">
                            <p>Authorized users only</p>
                            <p className="mt-2 text-xs">taylor@onmissiondigital.com • steve@onmissiondigital.com</p>
                        </div>
                    </div>
                </div>
            );
        }

        function App() {
            const [user, setUser] = useState(null);
            const [authChecked, setAuthChecked] = useState(false);

            useEffect(() => {
                const unsubscribe = auth.onAuthStateChanged((user) => {
                    setUser(user);
                    setAuthChecked(true);
                });

                return () => unsubscribe();
            }, []);

            if (!authChecked) {
                return (
                    <div className="min-h-screen bg-gray-50 flex items-center justify-center">
                        <div className="text-center">
                            <div className="animate-spin rounded-full h-16 w-16 border-b-2 border-orange-600 mx-auto mb-4"></div>
                            <p className="text-gray-600">Loading...</p>
                        </div>
                    </div>
                );
            }

            if (!user) {
                return <LoginScreen onLoginSuccess={() => setUser(auth.currentUser)} />;
            }

            return <OnMissionCRM user={user} />;
        }

        function OnMissionCRM({ user }) {
            const [contacts, setContacts] = useState([]);
            const [selectedContact, setSelectedContact] = useState(null);
            const [showAddContact, setShowAddContact] = useState(false);
            const [showAddHistory, setShowAddHistory] = useState(false);
            const [view, setView] = useState('grid');
            const [filterStatus, setFilterStatus] = useState('all');
            const [searchTerm, setSearchTerm] = useState('');
            const [isConnected, setIsConnected] = useState(true);
            const [loading, setLoading] = useState(true);
            const [showEmailCampaign, setShowEmailCampaign] = useState(false);
            const [showImportCSV, setShowImportCSV] = useState(false);
            const [emailQueue, setEmailQueue] = useState([]);
            const [campaignSettings, setCampaignSettings] = useState({ dailyLimit: 25, sendTime: '09:00', enabled: false });
            const [gmailAccessToken, setGmailAccessToken] = useState(null);
            const [gmailConnected, setGmailConnected] = useState(false);

            useEffect(() => {
                const unsubscribe = FirebaseService.subscribeToContacts((updatedContacts) => {
                    setContacts(updatedContacts);
                    setLoading(false);
                    setIsConnected(true);
                });
                
                return () => {
                    unsubscribe();
                };
            }, []);

            useEffect(() => {
                if (selectedContact) {
                    const updated = contacts.find(c => c.id === selectedContact.id);
                    if (updated) {
                        setSelectedContact(updated);
                    }
                }
            }, [contacts]);

            const filteredContacts = contacts.filter(contact => {
                const matchesSearch = contact.churchName?.toLowerCase().includes(searchTerm.toLowerCase()) ||
                                    contact.contactName?.toLowerCase().includes(searchTerm.toLowerCase()) ||
                                    contact.email?.toLowerCase().includes(searchTerm.toLowerCase());
                
                let matchesStatus = false;
                if (filterStatus === 'all') {
                    matchesStatus = true;
                } else if (filterStatus === 'needs-followup') {
                    matchesStatus = contact.followUpDate && new Date(contact.followUpDate) <= new Date(new Date().getTime() + 7*24*60*60*1000);
                } else if (filterStatus === 'overdue') {
                    const today = new Date();
                    today.setHours(0,0,0,0);
                    matchesStatus = contact.followUpDate && new Date(contact.followUpDate) < today;
                } else {
                    matchesStatus = contact.projectStatus === filterStatus;
                }
                
                return matchesSearch && matchesStatus;
            });

            const addContact = async (newContact) => {
                try {
                    await FirebaseService.addContact({
                        ...newContact,
                        history: []
                    }, user.email);
                    setShowAddContact(false);
                } catch (error) {
                    alert('Error adding contact. Please try again.');
                }
            };

            const updateContact = async (id, updatedData) => {
                try {
                    await FirebaseService.updateContact(id, updatedData, user.email);
                } catch (error) {
                    alert('Error updating contact. Please try again.');
                }
            };

            const deleteContact = async (id) => {
                if (confirm('Are you sure you want to delete this contact?')) {
                    try {
                        await FirebaseService.deleteContact(id);
                        if (selectedContact && selectedContact.id === id) {
                            setSelectedContact(null);
                        }
                    } catch (error) {
                        alert('Error deleting contact. Please try again.');
                    }
                }
            };

            const addHistory = async (contactId, historyItem) => {
                try {
                    await FirebaseService.addHistory(contactId, historyItem, user.email);
                    setShowAddHistory(false);
                } catch (error) {
                    alert('Error adding history. Please try again.');
                }
            };

            const handleSignOut = async () => {
                try {
                    await auth.signOut();
                } catch (error) {
                    console.error("Sign out error:", error);
                }
            };

            const getStatusColor = (status) => {
                const colors = {
                    'Lead': 'bg-blue-100 text-blue-800',
                    'Contacted': 'bg-yellow-100 text-yellow-800',
                    'Waiting Info/Call': 'bg-purple-100 text-purple-800',
                    'In Progress': 'bg-green-100 text-green-800',
                    'Completed': 'bg-gray-100 text-gray-800',
                    'On Hold': 'bg-red-100 text-red-800'
                };
                return colors[status] || 'bg-gray-100 text-gray-800';
            };
            
            const getInitials = (name) => {
                if (!name) return '?';
                const parts = name.trim().split(' ');
                if (parts.length === 1) return parts[0].substring(0, 2).toUpperCase();
                return (parts[0][0] + parts[parts.length - 1][0]).toUpperCase();
            };
            
            const getFollowUpStatus = (followUpDate) => {
                if (!followUpDate) return null;
                const dueDate = new Date(followUpDate);
                const today = new Date();
                today.setHours(0,0,0,0);
                const sevenDays = new Date(today.getTime() + 7*24*60*60*1000);
                
                if (dueDate < today) return 'overdue';
                if (dueDate <= sevenDays) return 'due-soon';
                return 'active';
            };

            const getHistoryIcon = (type) => {
                const icons = {
                    'call': 'fa-phone',
                    'email': 'fa-envelope',
                    'meeting': 'fa-users',
                    'payment': 'fa-dollar-sign',
                    'invoice': 'fa-file-invoice'
                };
                return icons[type] || 'fa-circle';
            };

            const connectGmail = () => {
                const client = google.accounts.oauth2.initTokenClient({
                    client_id: GMAIL_CLIENT_ID,
                    scope: GMAIL_SCOPES,
                    callback: (response) => {
                        if (response.access_token) {
                            setGmailAccessToken(response.access_token);
                            setGmailConnected(true);
                            alert('✅ Gmail connected successfully!');
                        }
                    },
                });
                client.requestAccessToken();
            };

            const sendEmailViaGmail = async (to, subject, body, contactId) => {
                if (!gmailAccessToken) {
                    alert('Please connect Gmail first!');
                    return;
                }

                try {
                    const email = [
                        `To: ${to}`,
                        `Subject: ${subject}`,
                        'Content-Type: text/plain; charset=utf-8',
                        '',
                        body
                    ].join('\n');

                    const encodedEmail = btoa(unescape(encodeURIComponent(email)))
                        .replace(/\+/g, '-')
                        .replace(/\//g, '_')
                        .replace(/=+$/, '');

                    const response = await fetch('https://gmail.googleapis.com/gmail/v1/users/me/messages/send', {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${gmailAccessToken}`,
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            raw: encodedEmail
                        })
                    });

                    if (response.ok) {
                        // Update contact as emailed
                        await FirebaseService.updateContact(contactId, { emailedAt: new Date().toISOString() }, user.email);
                        
                        // Update queue
                        setEmailQueue(emailQueue.map(q => 
                            q.contactId === contactId 
                                ? { ...q, status: 'sent', sentAt: new Date().toISOString() }
                                : q
                        ));
                        
                        return true;
                    } else {
                        throw new Error('Failed to send email');
                    }
                } catch (error) {
                    console.error('Error sending email:', error);
                    alert('Failed to send email. Please try again.');
                    return false;
                }
            };

            const exportToGoogleSheets = () => {
                const headers = ['Church Name', 'Contact Name', 'Email', 'Phone', 'Address', 'State', 'Website', 'Status', 'Pricing', 'Contacted'];
                const rows = contacts.map(c => [
                    c.churchName,
                    c.contactName,
                    c.email,
                    c.phone,
                    c.address,
                    c.state,
                    c.websiteUrl,
                    c.projectStatus,
                    c.pricing,
                    c.contacted ? 'Yes' : 'No'
                ]);
                
                const csv = [headers, ...rows].map(row => row.map(cell => `"${cell || ''}"`).join(',')).join('\n');
                const blob = new Blob([csv], { type: 'text/csv' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'onmission-contacts.csv';
                a.click();
            };

            if (loading) {
                return (
                    <div className="min-h-screen bg-gray-50 flex items-center justify-center">
                        <div className="text-center">
                            <div className="animate-spin rounded-full h-16 w-16 border-b-2 border-orange-600 mx-auto mb-4"></div>
                            <p className="text-gray-600">Loading your CRM...</p>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gray-50">
                    {/* Quick Add Button */}
                    <button 
                        onClick={() => setShowAddContact(true)}
                        className="quick-add-btn"
                        title="Quick Add Contact"
                    >
                        <i className="fas fa-plus"></i>
                    </button>

                    <div className="sync-indicator">
                        <div className={`sync-dot ${isConnected ? 'connected' : 'disconnected'}`}></div>
                        <span className="text-sm font-medium text-gray-700">
                            {isConnected ? 'Live' : 'Offline'}
                        </span>
                    </div>

                    <div className="gradient-bg text-white shadow-lg">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
                            <div className="flex justify-between items-center flex-wrap gap-4">
                                <div>
                                    <h1 className="text-3xl font-bold">OnMission Digital CRM</h1>
                                    <p className="text-orange-100 mt-1">Church Website Projects • Real-Time Sync</p>
                                </div>
                                <div className="flex gap-3 items-center flex-wrap">
                                    <div className="text-white text-sm bg-white bg-opacity-20 px-3 py-2 rounded-lg">
                                        <i className="fas fa-user mr-2"></i>
                                        {user.email}
                                    </div>
                                    <button
                                        onClick={exportToGoogleSheets}
                                        className="bg-white text-orange-600 px-4 py-2 rounded-lg font-medium hover:bg-orange-50 transition flex items-center gap-2"
                                    >
                                        <i className="fas fa-download"></i>
                                        Export
                                    </button>
                                    <button
                                        onClick={() => setShowAddContact(true)}
                                        className="bg-white text-orange-600 px-4 py-2 rounded-lg font-medium hover:bg-orange-50 transition flex items-center gap-2"
                                    >
                                        <i className="fas fa-plus"></i>
                                        Add Contact
                                    </button>
                                    <button
                                    onClick={() => setShowImportCSV(true)}
                                    className="bg-white text-orange-600 px-4 py-2 rounded-lg font-medium hover:bg-orange-50 transition flex items-center gap-2"
                                >
                                    <i className="fas fa-file-upload"></i>
                                    Import CSV
                                </button>
                                <button
                                    onClick={() => setShowEmailCampaign(true)}
                                    className="bg-white text-orange-600 px-4 py-2 rounded-lg font-medium hover:bg-orange-50 transition flex items-center gap-2"
                                >
                                    <i className="fas fa-envelope"></i>
                                    Email Campaign
                                </button>
                                    <button
                                        onClick={handleSignOut}
                                        className="bg-white bg-opacity-20 text-white px-4 py-2 rounded-lg font-medium hover:bg-opacity-30 transition"
                                    >
                                        <i className="fas fa-sign-out-alt mr-2"></i>
                                        Sign Out
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
                        <div className="bg-white rounded-lg shadow-md p-4 mb-6">
                            <div className="flex flex-wrap gap-4 items-center justify-between">
                                <div className="flex-1 min-w-[300px]">
                                    <div className="relative">
                                        <i className="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                                        <input
                                            type="text"
                                            placeholder="Search churches, contacts, or emails..."
                                            value={searchTerm}
                                            onChange={(e) => setSearchTerm(e.target.value)}
                                            className="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                                        />
                                    </div>
                                </div>
                                <div className="flex gap-2">
                                    <select
                                        value={filterStatus}
                                        onChange={(e) => setFilterStatus(e.target.value)}
                                        className="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500"
                                    >
                                        <option value="all">All Status</option>
                                        <option value="Lead">Lead</option>
                                        <option value="Contacted">Contacted</option>
                                        <option value="Waiting Info/Call">Waiting Info/Call</option>
                                        <option value="In Progress">In Progress</option>
                                        <option value="Completed">Completed</option>
                                        <option value="On Hold">On Hold</option>
                                        <option value="needs-followup">Needs Follow-Up</option>
                                        <option value="overdue">Overdue</option>
                                    </select>
                                    <div className="flex border border-gray-300 rounded-lg overflow-hidden">
    <button
        onClick={() => setView('grid')}
        className={`px-4 py-2 ${view === 'grid' ? 'bg-orange-100 text-orange-600' : 'bg-white text-gray-600'} hover:bg-gray-50`}
    >
        <i className="fas fa-th"></i>
    </button>
    <button
        onClick={() => setView('table')}
        className={`px-4 py-2 ${view === 'table' ? 'bg-orange-100 text-orange-600' : 'bg-white text-gray-600'} hover:bg-gray-50 border-l`}
    >
        <i className="fas fa-list"></i>
    </button>
    <button
        onClick={() => setView('kanban')}
        className={`px-4 py-2 ${view === 'kanban' ? 'bg-orange-100 text-orange-600' : 'bg-white text-gray-600'} hover:bg-gray-50 border-l`}
    >
        <i className="fas fa-columns"></i>
    </button>
</div>
                                </div>
                            </div>
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-6 gap-4 mb-6">
                            <div className="bg-white rounded-lg shadow-md p-4 cursor-pointer hover:shadow-md transition" onClick={() => setShowEmailCampaign(true)}>
                            <div className="flex items-center justify-between">
                                <div>
                                    <p className="text-gray-500 text-sm">Emails Queued</p>
                                    <p className="text-2xl font-bold text-gray-900">{emailQueue.length}</p>
                                </div>
                                <div className="icon-gradient-purple rounded-full p-3 shadow-md">
                                    <i className="fas fa-envelope text-purple-600"></i>
                                </div>
                            </div>
                        </div>
                            <div className="dashboard-widget">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <p className="text-gray-500 text-sm">Total Contacts</p>
                                        <p className="text-2xl font-bold text-gray-900">{contacts.length}</p>
                                    </div>
                                    <div className="icon-gradient-orange rounded-full p-3 shadow-md">
                                        <i className="fas fa-church text-orange-600"></i>
                                    </div>
                                </div>
                            </div>
                            <div className="dashboard-widget">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <p className="text-gray-500 text-sm">Active Projects</p>
                                        <p className="text-2xl font-bold text-gray-900">
                                            {contacts.filter(c => c.projectStatus === 'In Progress').length}
                                        </p>
                                    </div>
                                    <div className="icon-gradient-green rounded-full p-3 shadow-md">
                                        <i className="fas fa-tasks text-green-600"></i>
                                    </div>
                                </div>
                            </div>
                            <div className="dashboard-widget">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <p className="text-gray-500 text-sm">New Leads</p>
                                        <p className="text-2xl font-bold text-gray-900">
                                            {contacts.filter(c => c.projectStatus === 'Lead').length}
                                        </p>
                                    </div>
                                    <div className="icon-gradient-blue rounded-full p-3 shadow-md">
                                        <i className="fas fa-star text-blue-600"></i>
                                    </div>
                                </div>
                                <div className="dashboard-widget">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <p className="text-gray-500 text-sm">Tasks Due</p>
                                        <p className="text-2xl font-bold text-gray-900">
                                            {contacts.filter(c => {
                                                if (!c.followUpDate) return false;
                                                const dueDate = new Date(c.followUpDate);
                                                const today = new Date();
                                                today.setHours(0,0,0,0);
                                                return dueDate <= today;
                                            }).length}
                                        </p>
                                    </div>
                                    <div className="icon-gradient-red rounded-full p-3 shadow-md">
                                        <i className="fas fa-bell text-red-600"></i>
                                    </div>
                                </div>
                                <p className="text-xs text-gray-500 mt-2">
                                    {contacts.filter(c => {
                                        if (!c.followUpDate) return false;
                                        const dueDate = new Date(c.followUpDate);
                                        const today = new Date();
                                        today.setHours(0,0,0,0);
                                        return dueDate < today;
                                    }).length} overdue
                                </p>
                            </div>
                            </div>
                            <div className="dashboard-widget">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <p className="text-gray-500 text-sm">Completed</p>
                                        <p className="text-2xl font-bold text-gray-900">
                                            {contacts.filter(c => c.projectStatus === 'Completed').length}
                                        </p>
                                    </div>
                                    <div className="icon-gradient-gray rounded-full p-3 shadow-md">
                                        <i className="fas fa-check text-gray-600"></i>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                            <div className="dashboard-widget">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <p className="text-gray-500 text-sm">Pipeline Value</p>
                                        <p className="text-2xl font-bold text-gray-900">
                                            ${contacts.filter(c => c.projectStatus === 'In Progress' && c.projectRevenue)
                                                .reduce((sum, c) => sum + (parseFloat(c.projectRevenue.replace(/[$,]/g, '')) || 0), 0)
                                                .toLocaleString()}
                                        </p>
                                    </div>
                                    <div className="icon-gradient-green rounded-full p-3 shadow-md">
                                        <i className="fas fa-dollar-sign text-green-600"></i>
                                    </div>
                                </div>
                            </div>
                            <div className="dashboard-widget">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <p className="text-gray-500 text-sm">Total Revenue</p>
                                        <p className="text-2xl font-bold text-gray-900">
                                            ${contacts.filter(c => c.projectStatus === 'Completed' && c.projectRevenue)
                                                .reduce((sum, c) => sum + (parseFloat(c.projectRevenue.replace(/[$,]/g, '')) || 0), 0)
                                                .toLocaleString()}
                                        </p>
                                    </div>
                                    <div className="icon-gradient-blue rounded-full p-3 shadow-md">
                                        <i className="fas fa-money-bill-wave text-blue-600"></i>
                                    </div>
                                </div>
                            </div>
                            <div className="dashboard-widget">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <p className="text-gray-500 text-sm">Monthly Hosting</p>
                                        <p className="text-2xl font-bold text-gray-900">
                                            ${contacts.filter(c => c.monthlyHosting)
                                                .reduce((sum, c) => sum + (parseFloat(c.monthlyHosting.replace(/[$,\/mo]/g, '')) || 0), 0)
                                                .toLocaleString()}/mo
                                        </p>
                                    </div>
                                    <div className="icon-gradient-purple rounded-full p-3 shadow-md">
                                        <i className="fas fa-server text-purple-600"></i>
                                    </div>
                                </div>
                            </div>
                            <div className="dashboard-widget">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <p className="text-gray-500 text-sm">Avg Deal Size</p>
                                        <p className="text-2xl font-bold text-gray-900">
                                            ${contacts.filter(c => c.projectRevenue).length > 0 
                                                ? (contacts.filter(c => c.projectRevenue)
                                                    .reduce((sum, c) => sum + (parseFloat(c.projectRevenue.replace(/[$,]/g, '')) || 0), 0) / 
                                                    contacts.filter(c => c.projectRevenue).length).toFixed(0)
                                                : 0}
                                        </p>
                                    </div>
                                    <div className="icon-gradient-orange rounded-full p-3 shadow-md">
                                        <i className="fas fa-chart-line text-yellow-600"></i>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {contacts.length === 0 && (
                            <div className="bg-white rounded-lg shadow-md p-12 text-center">
                                <div className="text-gray-400 mb-4">
                                    <i className="fas fa-church text-6xl"></i>
                                </div>
                                <h3 className="text-xl font-semibold text-gray-900 mb-2">No Contacts Yet</h3>
                                <p className="text-gray-600 mb-6">Get started by adding your first church contact!</p>
                                <button
                                    onClick={() => setShowAddContact(true)}
                                    className="bg-orange-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-orange-700 transition"
                                >
                                    <i className="fas fa-plus mr-2"></i>
                                    Add Your First Contact
                                </button>
                            </div>
                        )}

{contacts.length > 0 && (
    view === 'kanban' ? (
        <div className="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4">
            {['Lead', 'Contacted', 'Waiting Info/Call', 'In Progress', 'Completed', 'On Hold'].map(status => (
                <div key={status} className="dashboard-widget">
                    <div className="flex items-center justify-between mb-4">
                        <h3 className="font-semibold text-gray-900">{status}</h3>
                        <span className={`status-badge ${getStatusColor(status)}`}>
                            {contacts.filter(c => c.projectStatus === status).length}
                        </span>
                    </div>
                    <div className="space-y-3">
                        {contacts.filter(c => c.projectStatus === status).map(contact => (
                            <div 
                                key={contact.id} 
                                className="bg-gray-50 rounded-lg p-3 cursor-pointer hover:shadow-md transition"
                                onClick={() => setSelectedContact(contact)}
                            >
                                <h4 className="font-medium text-sm text-gray-900 mb-1">{contact.churchName}</h4>
                                <p className="text-xs text-gray-600">{contact.contactName}</p>
                                <p className="text-xs font-semibold text-orange-600 mt-2">{contact.pricing}</p>
                            </div>
                        ))}
                    </div>
                </div>
            ))}
        </div>
    ) : view === 'grid' ? (
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {filteredContacts.map(contact => {
                const followUpStatus = getFollowUpStatus(contact.followUpDate);
                return (
                <div key={contact.id} className="bg-white rounded-lg shadow-md p-6 card cursor-pointer" onClick={() => setSelectedContact(contact)}>
                    <div className="contact-card-header">
                        <div className="profile-circle">
                            {getInitials(contact.contactName || contact.churchName)}
                        </div>
                        <div className="contact-card-info">
                            <div className="flex items-start justify-between gap-2 mb-1">
                                <h3 className="text-lg font-semibold text-gray-900 flex-1 min-w-0">{contact.churchName}</h3>
                                {followUpStatus && (
                                    <div className={`status-dot status-dot-${followUpStatus}`} title={
                                        followUpStatus === 'overdue' ? 'Overdue follow-up!' :
                                        followUpStatus === 'due-soon' ? 'Follow-up due soon' : 'Active'
                                    }></div>
                                )}
                            </div>
                            <p className="text-sm text-gray-600 mb-2">{contact.contactName}</p>
                            <div className="contact-card-meta">
                                <span className={`status-badge status-badge-enhanced ${getStatusColor(contact.projectStatus)}`}>
                                    {contact.projectStatus}
                                </span>
                                {contact.pricing && (
                                    <span className="text-xs font-semibold text-orange-600 bg-orange-50 px-2 py-1 rounded">
                                        {contact.pricing}
                                    </span>
                                )}
                            </div>
                        </div>
                    </div>
                    <div className="space-y-2 text-sm">
                        <div className="flex items-center text-gray-600">
                            <i className="fas fa-envelope w-5 text-gray-400"></i>
                            <span className="ml-2 truncate">{contact.email}</span>
                        </div>
                        <div className="flex items-center text-gray-600">
                            <i className="fas fa-phone w-5 text-gray-400"></i>
                            <span className="ml-2">{contact.phone}</span>
                        </div>
                        <div className="flex items-center text-gray-600">
                            <i className="fas fa-map-marker-alt w-5 text-gray-400"></i>
                            <span className="ml-2">{contact.state}</span>
                        </div>
                        {contact.followUpDate && (
                            <div className="flex items-center text-gray-600">
                                <i className="fas fa-calendar w-5 text-gray-400"></i>
                                <span className="ml-2">Follow-up: {new Date(contact.followUpDate).toLocaleDateString()}</span>
                            </div>
                        )}
                    </div>
                    <div className="mt-4 pt-4 border-t flex items-center justify-between">
                        <span className={`text-xs font-medium ${contact.contacted ? 'text-green-600' : 'text-red-600'}`}>
                            <i className={`fas fa-${contact.contacted ? 'check-circle' : 'times-circle'}`}></i>
                            {contact.contacted ? ' Contacted' : ' Not Contacted'}
                        </span>
                        <span className="text-xs text-gray-500">
                            {contact.history?.length || 0} activities
                        </span>
                    </div>
                </div>
                );
            })}
        </div>
    ) : (
        <div className="bg-white rounded-lg shadow-md overflow-x-auto">
            <table className="min-w-full divide-y divide-gray-200">
                <thead className="bg-gray-50">
                    <tr>
                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Church</th>
                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Contact</th>
                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Email</th>
                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Phone</th>
                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Pricing</th>
                    </tr>
                </thead>
                <tbody className="bg-white divide-y divide-gray-200">
                    {filteredContacts.map(contact => (
                        <tr key={contact.id} className="hover:bg-gray-50 cursor-pointer" onClick={() => setSelectedContact(contact)}>
                            <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{contact.churchName}</td>
                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-600">{contact.contactName}</td>
                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-600">{contact.email}</td>
                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-600">{contact.phone}</td>
                            <td className="px-6 py-4 whitespace-nowrap">
                                <span className={`status-badge ${getStatusColor(contact.projectStatus)}`}>
                                    {contact.projectStatus}
                                </span>
                            </td>
                            <td className="px-6 py-4 whitespace-nowrap text-sm font-semibold text-gray-900">{contact.pricing}</td>
                        </tr>
                    ))}
                </tbody>
            </table>
        </div>
    )
)}
                        
                    </div>

                    {selectedContact && (
                        <ContactDetailModal
                            contact={selectedContact}
                            onClose={() => setSelectedContact(null)}
                            onUpdate={updateContact}
                            onDelete={deleteContact}
                            onAddHistory={() => setShowAddHistory(true)}
                            getStatusColor={getStatusColor}
                            getHistoryIcon={getHistoryIcon}
                        />
                    )}

                    {showAddHistory && selectedContact && (
                        <AddHistoryModal
                            onClose={() => setShowAddHistory(false)}
                            onAdd={(item) => addHistory(selectedContact.id, item)}
                        />
                    )}

                    {showAddContact && (
                        <AddContactModal
                            onClose={() => setShowAddContact(false)}
                            onAdd={addContact}
                        />
                    )}
                            {showImportCSV && (
            <ImportCSVModal
                onClose={() => setShowImportCSV(false)}
                onImport={(contacts) => {
                    contacts.forEach(contact => addContact(contact));
                    setShowImportCSV(false);
                }}
            />
        )}
        
        {showEmailCampaign && (
            <EmailCampaignModal
                contacts={contacts}
                onClose={() => setShowEmailCampaign(false)}
                emailQueue={emailQueue}
                setEmailQueue={setEmailQueue}
                campaignSettings={campaignSettings}
                setCampaignSettings={setCampaignSettings}
                gmailConnected={gmailConnected}
                connectGmail={connectGmail}
                sendEmail={sendEmailViaGmail}
            />
        )}
                </div>
            );
        }

        function ContactDetailModal({ contact, onClose, onUpdate, onDelete, onAddHistory, getStatusColor, getHistoryIcon }) {
            const [isEditing, setIsEditing] = useState(false);
            const [editedContact, setEditedContact] = useState(contact);

            const handleSave = () => {
                onUpdate(contact.id, editedContact);
                setIsEditing(false);
            };

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50" onClick={onClose}>
                    <div className="bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto" onClick={(e) => e.stopPropagation()}>
                        <div className="sticky top-0 bg-white border-b px-6 py-4 flex justify-between items-center">
                            <h2 className="text-2xl font-bold text-gray-900">{contact.churchName}</h2>
                            <div className="flex gap-2">
                                {!isEditing ? (
                                    <>
                                        <button onClick={() => setIsEditing(true)} className="px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700">
                                            <i className="fas fa-edit mr-2"></i>Edit
                                        </button>
                                        <button onClick={() => onDelete(contact.id)} className="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">
                                            <i className="fas fa-trash mr-2"></i>Delete
                                        </button>
                                    </>
                                ) : (
                                    <>
                                        <button onClick={handleSave} className="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                                            <i className="fas fa-check mr-2"></i>Save
                                        </button>
                                        <button onClick={() => { setIsEditing(false); setEditedContact(contact); }} className="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700">
                                            Cancel
                                        </button>
                                    </>
                                )}
                                <button onClick={onClose} className="px-4 py-2 text-gray-600 hover:text-gray-900">
                                    <i className="fas fa-times text-xl"></i>
                                </button>
                            </div>
                        </div>

                        <div className="p-6">
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                                <div>
                                    <h3 className="text-lg font-semibold mb-4">Contact Information</h3>
                                    <div className="space-y-3">
            
                                        <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">Full Contact Name</label>
                                {isEditing ? (
                                    <input
                                        type="text"
                                        value={editedContact.fullContactName || ''}
                                        onChange={(e) => setEditedContact({ ...editedContact, fullContactName: e.target.value })}
                                        className="w-full px-3 py-2 border rounded-lg"
                                    />
    ) : (
        <p className="text-gray-900">{contact.fullContactName || 'Not provided'}</p>
    )}
</div>
```

---

## 📄 **CSV IS ALREADY READY!**

The CSV file I just gave you already has both columns:
- **First Name** → Maps to "Contact Name" (for emails)
- **Full Name** → Maps to "Full Contact Name" (for records)

---

## 📥 **How to Import After Code Update:**

1. **Update your CRM code** with the 3 changes above
2. **Commit to GitHub**
3. **Wait for Netlify to deploy** (1-2 min)
4. **Import the CSV** with this mapping:

**Your CSV Column** → **CRM Field**
- Association Name → Church Name
- First Name → Contact Name ✅
- Full Name → Full Contact Name ✅ (NEW!)
- Email Address → Email
- State → State
- Website URL → Website

---

## 📧 **Result:**

**In CRM:**
- Contact Name: Gary (used in emails)
- Full Contact Name: Gary Ellcessor (shown in contact details)

**In Emails:**
```
Gary,

Hope you are doing well!

We came across Anderson Baptist Association...
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Email</label>
                                            {isEditing ? (
                                                <input
                                                    type="email"
                                                    value={editedContact.email}
                                                    onChange={(e) => setEditedContact({ ...editedContact, email: e.target.value })}
                                                    className="w-full px-3 py-2 border rounded-lg"
                                                />
                                            ) : (
                                                <p className="text-gray-900">{contact.email}</p>
                                            )}
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Phone</label>
                                            {isEditing ? (
                                                <input
                                                    type="tel"
                                                    value={editedContact.phone}
                                                    onChange={(e) => setEditedContact({ ...editedContact, phone: e.target.value })}
                                                    className="w-full px-3 py-2 border rounded-lg"
                                                />
                                            ) : (
                                                <p className="text-gray-900">{contact.phone}</p>
                                            )}
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Address</label>
                                            {isEditing ? (
                                                <input
                                                    type="text"
                                                    value={editedContact.address}
                                                    onChange={(e) => setEditedContact({ ...editedContact, address: e.target.value })}
                                                    className="w-full px-3 py-2 border rounded-lg"
                                                />
                                            ) : (
                                                <p className="text-gray-900">{contact.address}</p>
                                            )}
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">State</label>
                                            {isEditing ? (
                                                <input
                                                    type="text"
                                                    value={editedContact.state}
                                                    onChange={(e) => setEditedContact({ ...editedContact, state: e.target.value })}
                                                    className="w-full px-3 py-2 border rounded-lg"
                                                />
                                            ) : (
                                                <p className="text-gray-900">{contact.state}</p>
                                            )}
                                        </div>
                                    </div>
                                </div>

                                <div>
                                    <h3 className="text-lg font-semibold mb-4">Project Details</h3>
                                    <div className="space-y-3">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Website URL</label>
                                            {isEditing ? (
                                                <input
                                                    type="text"
                                                    value={editedContact.websiteUrl}
                                                    onChange={(e) => setEditedContact({ ...editedContact, websiteUrl: e.target.value })}
                                                    className="w-full px-3 py-2 border rounded-lg"
                                                />
                                            ) : (
                                                <p className="text-gray-900">{contact.websiteUrl || 'Not provided'}</p>
                                            )}
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Project Status</label>
                                            {isEditing ? (
                                                <select
                                                    value={editedContact.projectStatus}
                                                    onChange={(e) => setEditedContact({ ...editedContact, projectStatus: e.target.value })}
                                                    className="w-full px-3 py-2 border rounded-lg"
                                                >
                                                    <option>Lead</option>
                                                    <option>Contacted</option>
                                                    <option>Waiting Info/Call</option>
                                                    <option>In Progress</option>
                                                    <option>Completed</option>
                                                    <option>On Hold</option>
                                                </select>
                                            ) : (
                                                <span className={`status-badge ${getStatusColor(contact.projectStatus)}`}>
                                                    {contact.projectStatus}
                                                </span>
                                            )}
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Pricing</label>
                                            {isEditing ? (
                                                <input
                                                    type="text"
                                                    value={editedContact.pricing}
                                                    onChange={(e) => setEditedContact({ ...editedContact, pricing: e.target.value })}
                                                    className="w-full px-3 py-2 border rounded-lg"
                                                />
                                            ) : (
                                                <p className="text-gray-900 font-semibold">{contact.pricing}</p>
                                            )}
                                        </div>
                                       <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Follow-Up Date</label>
                                            {isEditing ? (
                                                <input
                                                    type="date"
                                                    value={editedContact.followUpDate || ''}
                                                    onChange={(e) => setEditedContact({ ...editedContact, followUpDate: e.target.value })}
                                                    className="w-full px-3 py-2 border rounded-lg"
                                                />
                                            ) : (
                                                <p className="text-gray-900">{contact.followUpDate ? new Date(contact.followUpDate).toLocaleDateString() : 'Not set'}</p>
                                            )}
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Project Revenue</label>
                                            {isEditing ? (
                                                <input
                                                    type="text"
                                                    value={editedContact.projectRevenue || ''}
                                                    onChange={(e) => setEditedContact({ ...editedContact, projectRevenue: e.target.value })}
                                                    className="w-full px-3 py-2 border rounded-lg"
                                                    placeholder="$3,500"
                                                />
                                            ) : (
                                                <p className="text-gray-900">{contact.projectRevenue || 'Not set'}</p>
                                            )}
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Monthly Hosting</label>
                                            {isEditing ? (
                                                <input
                                                    type="text"
                                                    value={editedContact.monthlyHosting || ''}
                                                    onChange={(e) => setEditedContact({ ...editedContact, monthlyHosting: e.target.value })}
                                                    className="w-full px-3 py-2 border rounded-lg"
                                                    placeholder="$25/mo"
                                                />
                                            ) : (
                                                <p className="text-gray-900">{contact.monthlyHosting || 'Not set'}</p>
                                            )}
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Contacted</label>
                                            {isEditing ? (
                                                <select
                                                    value={editedContact.contacted}
                                                    onChange={(e) => setEditedContact({ ...editedContact, contacted: e.target.value === 'true' })}
                                                    className="w-full px-3 py-2 border rounded-lg"
                                                >
                                                    <option value="true">Yes</option>
                                                    <option value="false">No</option>
                                                </select>
                                            ) : (
                                                <span className={`text-sm font-medium ${contact.contacted ? 'text-green-600' : 'text-red-600'}`}>
                                                    <i className={`fas fa-${contact.contacted ? 'check-circle' : 'times-circle'} mr-1`}></i>
                                                    {contact.contacted ? 'Yes' : 'No'}
                                                </span>
                                            )}
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div>
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className="text-lg font-semibold">Contact History</h3>
                                    <button
                                        onClick={onAddHistory}
                                        className="px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 text-sm"
                                    >
                                        <i className="fas fa-plus mr-2"></i>Add Activity
                                    </button>
                                </div>
                                {contact.history && contact.history.length > 0 ? (
                                    <div className="space-y-4">
                                        {contact.history.map(item => (
                                            <div key={item.id} className="timeline-item">
                                                <div className={`timeline-dot bg-${item.type === 'payment' ? 'green' : 'orange'}-500`}></div>
                                                <div className="bg-gray-50 rounded-lg p-4">
                                                    <div className="flex items-start justify-between mb-2">
                                                        <div className="flex items-center gap-2">
                                                            <i className={`fas ${getHistoryIcon(item.type)} text-orange-600`}></i>
                                                            <span className="font-medium text-gray-900 capitalize">{item.type}</span>
                                                            <span className="text-gray-500 text-sm">• {item.date}</span>
                                                        </div>
                                                        <span className="text-xs text-gray-500">{item.user}</span>
                                                    </div>
                                                    <p className="text-gray-700 text-sm">{item.note}</p>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                ) : (
                                    <div className="text-center py-8 text-gray-500">
                                        <i className="fas fa-inbox text-4xl mb-3"></i>
                                        <p>No activity history yet</p>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        function AddHistoryModal({ onClose, onAdd }) {
            const [type, setType] = useState('call');
            const [note, setNote] = useState('');

            const handleSubmit = (e) => {
                e.preventDefault();
                if (note.trim()) {
                    onAdd({ type, note });
                    onClose();
                }
            };

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50" onClick={onClose}>
                    <div className="bg-white rounded-lg max-w-lg w-full p-6" onClick={(e) => e.stopPropagation()}>
                        <h2 className="text-2xl font-bold mb-4">Add Activity</h2>
                        <form onSubmit={handleSubmit}>
                            <div className="space-y-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Activity Type</label>
                                    <select
                                        value={type}
                                        onChange={(e) => setType(e.target.value)}
                                        className="w-full px-3 py-2 border rounded-lg"
                                    >
                                        <option value="call">Phone Call</option>
                                        <option value="email">Email</option>
                                        <option value="meeting">Meeting</option>
                                        <option value="payment">Payment Received</option>
                                        <option value="invoice">Invoice Sent</option>
                                    </select>
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Notes</label>
                                    <textarea
                                        value={note}
                                        onChange={(e) => setNote(e.target.value)}
                                        className="w-full px-3 py-2 border rounded-lg"
                                        rows="4"
                                        placeholder="What happened?"
                                        required
                                    ></textarea>
                                </div>
                            </div>
                            <div className="flex gap-2 mt-6">
                                <button type="submit" className="flex-1 px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700">
                                    Add Activity
                                </button>
                                <button type="button" onClick={onClose} className="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300">
                                    Cancel
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        }

        function AddContactModal({ onClose, onAdd }) {
            const [formData, setFormData] = useState({
                churchName: '',
                contactName: '',
                fullContactName: '',
                email: '',
                phone: '',
                address: '',
                state: '',
                websiteUrl: '',
                projectStatus: 'Lead',
                pricing: '',
                contacted: false,
                followUpDate: '',
                monthlyHosting: '',
                projectRevenue: ''
            });

            const handleSubmit = (e) => {
                e.preventDefault();
                onAdd(formData);
            };

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50" onClick={onClose}>
                    <div className="bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto p-6" onClick={(e) => e.stopPropagation()}>
                        <h2 className="text-2xl font-bold mb-4">Add New Contact</h2>
                        <form onSubmit={handleSubmit}>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
    <label className="block text-sm font-medium text-gray-700 mb-1">Contact Name (First Name) *</label>
    <input
        type="text"
        value={formData.contactName}
        onChange={(e) => setFormData({ ...formData, contactName: e.target.value })}
        className="w-full px-3 py-2 border rounded-lg"
        placeholder="Gary"
        required
    />
</div>
<div>
    <label className="block text-sm font-medium text-gray-700 mb-1">Full Contact Name</label>
    <input
        type="text"
        value={formData.fullContactName || ''}
        onChange={(e) => setFormData({ ...formData, fullContactName: e.target.value })}
        className="w-full px-3 py-2 border rounded-lg"
        placeholder="Gary Ellcessor"
    />
</div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Contact Name *</label>
                                    <input
                                        type="text"
                                        value={formData.contactName}
                                        onChange={(e) => setFormData({ ...formData, contactName: e.target.value })}
                                        className="w-full px-3 py-2 border rounded-lg"
                                        required
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Email *</label>
                                    <input
                                        type="email"
                                        value={formData.email}
                                        onChange={(e) => setFormData({ ...formData, email: e.target.value })}
                                        className="w-full px-3 py-2 border rounded-lg"
                                        required
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Phone *</label>
                                    <input
                                        type="tel"
                                        value={formData.phone}
                                        onChange={(e) => setFormData({ ...formData, phone: e.target.value })}
                                        className="w-full px-3 py-2 border rounded-lg"
                                        required
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Address</label>
                                    <input
                                        type="text"
                                        value={formData.address}
                                        onChange={(e) => setFormData({ ...formData, address: e.target.value })}
                                        className="w-full px-3 py-2 border rounded-lg"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">State</label>
                                    <input
                                        type="text"
                                        value={formData.state}
                                        onChange={(e) => setFormData({ ...formData, state: e.target.value })}
                                        className="w-full px-3 py-2 border rounded-lg"
                                        placeholder="TN"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Website URL</label>
                                    <input
                                        type="text"
                                        value={formData.websiteUrl}
                                        onChange={(e) => setFormData({ ...formData, websiteUrl: e.target.value })}
                                        className="w-full px-3 py-2 border rounded-lg"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Project Status</label>
                                    <select
                                        value={formData.projectStatus}
                                        onChange={(e) => setFormData({ ...formData, projectStatus: e.target.value })}
                                        className="w-full px-3 py-2 border rounded-lg"
                                    >
                                        <option>Lead</option>
                                        <option>Contacted</option>
                                        <option>Waiting Info/Call</option>
                                        <option>In Progress</option>
                                        <option>Completed</option>
                                        <option>On Hold</option>
                                    </select>
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Pricing</label>
                                    <input
                                        type="text"
                                        value={formData.pricing}
                                        onChange={(e) => setFormData({ ...formData, pricing: e.target.value })}
                                        className="w-full px-3 py-2 border rounded-lg"
                                        placeholder="$3,500"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Follow-Up Date</label>
                                    <input
                                        type="date"
                                        value={formData.followUpDate || ''}
                                        onChange={(e) => setFormData({ ...formData, followUpDate: e.target.value })}
                                        className="w-full px-3 py-2 border rounded-lg"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Project Revenue</label>
                                    <input
                                        type="text"
                                        value={formData.projectRevenue || ''}
                                        onChange={(e) => setFormData({ ...formData, projectRevenue: e.target.value })}
                                        className="w-full px-3 py-2 border rounded-lg"
                                        placeholder="$3,500"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Monthly Hosting</label>
                                    <input
                                        type="text"
                                        value={formData.monthlyHosting || ''}
                                        onChange={(e) => setFormData({ ...formData, monthlyHosting: e.target.value })}
                                        className="w-full px-3 py-2 border rounded-lg"
                                        placeholder="$25/mo"
                                    />
                                </div>
                                <div className="flex items-center">
                                    <input
                                        type="checkbox"
                                        checked={formData.contacted}
                                        onChange={(e) => setFormData({ ...formData, contacted: e.target.checked })}
                                        className="w-4 h-4 text-orange-600 rounded"
                                    />
                                    <label className="ml-2 text-sm text-gray-700">Already contacted</label>
                                </div>
                            </div>
                            <div className="flex gap-2 mt-6">
                                <button type="submit" className="flex-1 px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700">
                                    Add Contact
                                </button>
                                <button type="button" onClick={onClose} className="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300">
                                    Cancel
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        }
function ImportCSVModal({ onClose, onImport }) {
    const [csvData, setCsvData] = useState([]);
    const [headers, setHeaders] = useState([]);
    const [mapping, setMapping] = useState({});
    const [step, setStep] = useState(1);

    const handleFileUpload = (e) => {
        const file = e.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = (event) => {
            const text = event.target.result;
            const lines = text.split('\n').filter(line => line.trim());
            const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
            const data = lines.slice(1).map(line => {
                const values = line.split(',').map(v => v.trim().replace(/"/g, ''));
                const obj = {};
                headers.forEach((header, index) => {
                    obj[header] = values[index] || '';
                });
                return obj;
            });

            setHeaders(headers);
            setCsvData(data);
            setStep(2);
        };
        reader.readAsText(file);
    };

    const handleImport = () => {
        const contacts = csvData.map(row => ({
            churchName: row[mapping.churchName] || '',
            contactName: row[mapping.contactName] || '',
            email: row[mapping.email] || '',
            phone: row[mapping.phone] || '',
            address: row[mapping.address] || '',
            state: row[mapping.state] || '',
            websiteUrl: row[mapping.website] || '',
            projectStatus: 'Lead',
            pricing: '',
            contacted: false,
            followUpDate: ''
        }));

        onImport(contacts);
    };

    return (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50" onClick={onClose}>
            <div className="bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto p-6" onClick={(e) => e.stopPropagation()}>
                <div className="flex justify-between items-center mb-6">
                    <h2 className="text-2xl font-bold">Import Contacts from CSV</h2>
                    <button onClick={onClose} className="text-gray-600 hover:text-gray-900">
                        <i className="fas fa-times text-xl"></i>
                    </button>
                </div>

                {step === 1 && (
                    <div className="text-center py-12">
                        <div className="mb-6">
                            <i className="fas fa-file-csv text-6xl text-orange-600 mb-4"></i>
                        </div>
                        <h3 className="text-xl font-semibold mb-4">Upload Your CSV File</h3>
                        <p className="text-gray-600 mb-6">Select a CSV file with your church contacts</p>
                        <input
                            type="file"
                            accept=".csv"
                            onChange={handleFileUpload}
                            className="hidden"
                            id="csv-upload"
                        />
                        <label
                            htmlFor="csv-upload"
                            className="inline-block bg-orange-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-orange-700 cursor-pointer"
                        >
                            <i className="fas fa-upload mr-2"></i>
                            Choose CSV File
                        </label>
                    </div>
                )}

         {step === 2 && (
    <div>
        <h3 className="text-lg font-semibold mb-4">Map Your Columns</h3>
        <p className="text-gray-600 mb-6">Match your CSV columns to CRM fields</p>
        <div className="space-y-4">
            {[
                { key: 'churchName', label: 'Church Name' },
                { key: 'contactName', label: 'Contact Name' },
                { key: 'fullContactName', label: 'Full Contact Name' },
                { key: 'email', label: 'Email' },
                { key: 'phone', label: 'Phone' },
                { key: 'address', label: 'Address' },
                { key: 'state', label: 'State' },
                { key: 'website', label: 'Website' }
            ].map(field => (
                <div key={field.key} className="grid grid-cols-2 gap-4 items-center">
                    <label className="font-medium">{field.label}:</label>
                    <select
                        value={mapping[field.key] || ''}
                        onChange={(e) => setMapping({ ...mapping, [field.key]: e.target.value })}
                        className="px-3 py-2 border rounded-lg"
                    >
                        <option value="">-- Select Column --</option>
                        {headers.map(header => (
                            <option key={header} value={header}>{header}</option>
                        ))}
                    </select>
                </div>
            ))}
        </div>
)}                    
                        <div className="flex gap-3 mt-6">
                            <button
                                onClick={() => setStep(3)}
                                disabled={!mapping.churchName || !mapping.email}
                                className="flex-1 bg-orange-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-orange-700 disabled:opacity-50"
                            >
                                Preview Import
                            </button>
                            <button
                                onClick={() => setStep(1)}
                                className="px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300"
                            >
                                Back
                            </button>
                        </div>
                    </div>
                )}

                {step === 3 && (
                    <div>
                        <h3 className="text-lg font-semibold mb-4">Preview Import ({csvData.length} contacts)</h3>
                        <div className="max-h-96 overflow-y-auto mb-6">
                            <table className="min-w-full divide-y divide-gray-200">
                                <thead className="bg-gray-50 sticky top-0">
                                    <tr>
                                        <th className="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Church</th>
                                        <th className="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Contact</th>
                                        <th className="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Email</th>
                                        <th className="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Phone</th>
                                    </tr>
                                </thead>
                                <tbody className="bg-white divide-y divide-gray-200">
                                    {csvData.slice(0, 10).map((row, idx) => (
                                        <tr key={idx}>
                                            <td className="px-4 py-2 text-sm">{row[mapping.churchName]}</td>
                                            <td className="px-4 py-2 text-sm">{row[mapping.contactName]}</td>
                                            <td className="px-4 py-2 text-sm">{row[mapping.email]}</td>
                                            <td className="px-4 py-2 text-sm">{row[mapping.phone]}</td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                        <div className="flex gap-3">
                            <button
                                onClick={handleImport}
                                className="flex-1 bg-green-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-green-700"
                            >
                                <i className="fas fa-check mr-2"></i>
                                Import {csvData.length} Contacts
                            </button>
                            <button
                                onClick={() => setStep(2)}
                                className="px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300"
                            >
                                Back
                            </button>
                        </div>
                    </div>
                )}
            </div>
        </div>
    );
}

function EmailCampaignModal({ contacts, onClose, emailQueue, setEmailQueue, campaignSettings, setCampaignSettings, gmailConnected, connectGmail, sendEmail }) {
    const [activeTab, setActiveTab] = useState('queue');
    const [emailTemplate, setEmailTemplate] = useState({
        subject: 'OnMission Digital - {ChurchName} ',
        body: `{ContactName},

Hope you are doing well!

We've been helping churches and church plants get their digital presence up and running without the usual price tag. After seeing too many smaller congregations and associations either go without a website or get locked into expensive contracts, we decided to offer these services at cost, covering just our operational expenses so churches can focus their resources on ministry.

We came across {ChurchName} and thought we'd reach out. If you or any churches in your network need a website or giving platform set up, we'd love to help. Here are some recent build outs we have done:

- Mission Vida: https://missionvida.org
- Echo KY: https://echoky.org

We'd love to hear what you might need and see if we can help, no pressure either way.

We really appreciate the work you're doing, and we're here to support however we can.`
    });
    const [filterStatus, setFilterStatus] = useState('Lead');

    const addToQueue = () => {
        const newQueue = contacts
            .filter(c => c.projectStatus === filterStatus && !c.emailedAt)
            .map(c => ({
                contactId: c.id,
                churchName: c.churchName,
                contactName: c.contactName,
                email: c.email,
                status: 'pending',
                scheduledFor: null
            }));
        setEmailQueue([...emailQueue, ...newQueue]);
    };

    const removeFromQueue = (contactId) => {
        setEmailQueue(emailQueue.filter(q => q.contactId !== contactId));
    };

    const sentToday = emailQueue.filter(q => q.status === 'sent' && 
        new Date(q.sentAt).toDateString() === new Date().toDateString()
    ).length;

    return (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50" onClick={onClose}>
            <div className="bg-white rounded-lg max-w-6xl w-full max-h-[90vh] overflow-y-auto" onClick={(e) => e.stopPropagation()}>
                <div className="sticky top-0 bg-white border-b px-6 py-4 flex justify-between items-center">
                    <h2 className="text-2xl font-bold">Email Campaign Manager</h2>
                    <button onClick={onClose} className="text-gray-600 hover:text-gray-900">
                        <i className="fas fa-times text-xl"></i>
                    </button>
                </div>

                <div className="border-b">
                    <div className="flex px-6">
                        <button
                            onClick={() => setActiveTab('queue')}
                            className={`px-4 py-3 font-medium border-b-2 ${activeTab === 'queue' ? 'border-orange-600 text-orange-600' : 'border-transparent text-gray-600'}`}
                        >
                            <i className="fas fa-list mr-2"></i>
                            Queue ({emailQueue.length})
                        </button>
                        <button
                            onClick={() => setActiveTab('templates')}
                            className={`px-4 py-3 font-medium border-b-2 ${activeTab === 'templates' ? 'border-orange-600 text-orange-600' : 'border-transparent text-gray-600'}`}
                        >
                            <i className="fas fa-file-alt mr-2"></i>
                            Template
                        </button>
                        <button
                            onClick={() => setActiveTab('settings')}
                            className={`px-4 py-3 font-medium border-b-2 ${activeTab === 'settings' ? 'border-orange-600 text-orange-600' : 'border-transparent text-gray-600'}`}
                        >
                            <i className="fas fa-cog mr-2"></i>
                            Settings
                        </button>
                    </div>
                </div>

                <div className="p-6">
                    {activeTab === 'queue' && (
                        <div>
                            <div className="grid grid-cols-3 gap-4 mb-6">
                                <div className="bg-blue-50 rounded-lg p-4">
                                    <p className="text-sm text-blue-600 font-medium">Pending</p>
                                    <p className="text-2xl font-bold text-blue-900">{emailQueue.filter(q => q.status === 'pending').length}</p>
                                </div>
                                <div className="bg-green-50 rounded-lg p-4">
                                    <p className="text-sm text-green-600 font-medium">Sent Today</p>
                                    <p className="text-2xl font-bold text-green-900">{sentToday} / {campaignSettings.dailyLimit}</p>
                                </div>
                                <div className="bg-purple-50 rounded-lg p-4">
                                    <p className="text-sm text-purple-600 font-medium">Next Send</p>
                                    <p className="text-2xl font-bold text-purple-900">{campaignSettings.sendTime}</p>
                                </div>
                            </div>

                            <div className="bg-gray-50 rounded-lg p-4 mb-6">
                                <h3 className="font-semibold mb-3">Add Contacts to Queue</h3>
                                <div className="flex gap-3">
                                    <select
                                        value={filterStatus}
                                        onChange={(e) => setFilterStatus(e.target.value)}
                                        className="flex-1 px-3 py-2 border rounded-lg"
                                    >
                                        <option value="Lead">Lead</option>
                                        <option value="Contacted">Contacted</option>
                                        <option value="Waiting Info/Call">Waiting Info/Call</option>
                                    </select>
                                    <button
                                        onClick={addToQueue}
                                        className="bg-orange-600 text-white px-6 py-2 rounded-lg hover:bg-orange-700"
                                    >
                                        <i className="fas fa-plus mr-2"></i>
                                        Add to Queue
                                    </button>
                                </div>
                            </div>

                            <div className="space-y-2">
                                {emailQueue.map((item, idx) => {
                                    const contact = contacts.find(c => c.id === item.contactId);
                                    return (
                                    <div key={idx} className="bg-white border rounded-lg p-4 flex items-center justify-between">
                                        <div className="flex-1">
                                            <h4 className="font-medium">{item.churchName}</h4>
                                            <p className="text-sm text-gray-600">{item.contactName} • {item.email}</p>
                                        </div>
                                        <div className="flex items-center gap-4">
                                            <span className={`text-xs px-3 py-1 rounded-full ${
                                                item.status === 'sent' ? 'bg-green-100 text-green-700' :
                                                item.status === 'pending' ? 'bg-blue-100 text-blue-700' :
                                                'bg-gray-100 text-gray-700'
                                            }`}>
                                                {item.status}
                                            </span>
                                            {item.status === 'pending' && gmailConnected && (
                                                <button
                                                    onClick={async () => {
                                                        if (!contact) return;
                                                        const subject = emailTemplate.subject
                                                            .replace('{ChurchName}', contact.churchName || '')
                                                            .replace('{ContactName}', contact.contactName || '')
                                                            .replace('{State}', contact.state || '');
                                                        const body = emailTemplate.body
                                                            .replace(/{ChurchName}/g, contact.churchName || '')
                                                            .replace(/{ContactName}/g, contact.contactName || '')
                                                            .replace(/{State}/g, contact.state || '');
                                                        
                                                        await sendEmail(contact.email, subject, body, contact.id);
                                                    }}
                                                    className="bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700"
                                                >
                                                    <i className="fas fa-paper-plane mr-1"></i>
                                                    Send
                                                </button>
                                            )}
                                            {item.status === 'pending' && (
                                                <button
                                                    onClick={() => removeFromQueue(item.contactId)}
                                                    className="text-red-600 hover:text-red-800"
                                                >
                                                    <i className="fas fa-trash"></i>
                                                </button>
                                            )}
                                        </div>
                                    </div>
                                    );
                                })}
                                {emailQueue.length === 0 && (
                                    <div className="text-center py-12 text-gray-500">
                                        <i className="fas fa-inbox text-4xl mb-3"></i>
                                        <p>No emails in queue. Add contacts above to get started!</p>
                                    </div>
                                )}
                            </div>
                        </div>
                    )}

                    {activeTab === 'templates' && (
                        <div>
                            <h3 className="font-semibold mb-4">Email Template</h3>
                            <div className="space-y-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">Subject Line</label>
                                    <input
                                        type="text"
                                        value={emailTemplate.subject}
                                        onChange={(e) => setEmailTemplate({ ...emailTemplate, subject: e.target.value })}
                                        className="w-full px-4 py-2 border rounded-lg"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">Email Body</label>
                                    <textarea
                                        value={emailTemplate.body}
                                        onChange={(e) => setEmailTemplate({ ...emailTemplate, body: e.target.value })}
                                        className="w-full px-4 py-2 border rounded-lg font-mono text-sm"
                                        rows="20"
                                    />
                                </div>
                                <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
                                    <h4 className="font-medium text-blue-900 mb-2">Available Variables:</h4>
                                    <p className="text-sm text-blue-700">
                                        <code>{'{ChurchName}'}</code> • <code>{'{ContactName}'}</code> • <code>{'{State}'}</code>
                                    </p>
                                </div>
                            </div>
                        </div>
                    )}

                    {activeTab === 'settings' && (
                        <div className="space-y-6">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">Daily Email Limit</label>
                                <input
                                    type="number"
                                    value={campaignSettings.dailyLimit}
                                    onChange={(e) => setCampaignSettings({ ...campaignSettings, dailyLimit: parseInt(e.target.value) })}
                                    className="w-full px-4 py-2 border rounded-lg"
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">Send Time (Daily)</label>
                                <input
                                    type="time"
                                    value={campaignSettings.sendTime}
                                    onChange={(e) => setCampaignSettings({ ...campaignSettings, sendTime: e.target.value })}
                                    className="w-full px-4 py-2 border rounded-lg"
                                />
                            </div>
                            <div className="flex items-center gap-3">
                                <input
                                    type="checkbox"
                                    checked={campaignSettings.enabled}
                                    onChange={(e) => setCampaignSettings({ ...campaignSettings, enabled: e.target.checked })}
                                    className="w-5 h-5 text-orange-600 rounded"
                                />
                                <label className="font-medium">Enable Automatic Sending</label>
                            </div>
                            <div className={`${gmailConnected ? 'bg-green-50 border-green-200' : 'bg-yellow-50 border-yellow-200'} border rounded-lg p-4`}>
                                <h4 className={`font-medium ${gmailConnected ? 'text-green-900' : 'text-yellow-900'} mb-2`}>
                                    <i className={`fas ${gmailConnected ? 'fa-check-circle' : 'fa-exclamation-triangle'} mr-2`}></i>
                                    {gmailConnected ? 'Gmail Connected!' : 'Gmail Integration Required'}
                                </h4>
                                <p className={`text-sm ${gmailConnected ? 'text-green-700' : 'text-yellow-700'} mb-3`}>
                                    {gmailConnected 
                                        ? 'You can now send emails directly from the CRM!'
                                        : 'Connect your Gmail account to send emails.'}
                                </p>
                                {!gmailConnected && (
                                    <button 
                                        onClick={connectGmail}
                                        className="bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700 text-sm"
                                    >
                                        <i className="fab fa-google mr-2"></i>
                                        Connect Gmail
                                    </button>
                                )}
                            </div>
                        </div>
                    )}
                </div>
            </div>
        </div>
    );
}
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
